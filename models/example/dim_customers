with customers as (
select 
id as customer_id,
  first_name,
  last_name 
  from customers_dbt_tests
),
order_cte as (
select id as order_id,
user_id as customer_id,
order_date,
status
from 
orders ),
customer_orders as (
select customer_id, min(order_date) first_date, max(order_date) latest_date
  ,
  count(order_id
       ) no_of_orders
  from order_cte group by 1
),
final as (
select 
customers.customer_id,
  customers.first_name,
  customers.last_name,
  customer_orders.first_date,
  customer_orders.latest_date,
  coalesce(customer_orders.no_of_orders,0) as no_of_orders
  from customers left join customer_orders using (customer_id)
  )
  select * from final
